<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Совместное рисование - Большой холст</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.5rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }
        
        .online-counter {
            font-size: 1.2rem;
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .tools-panel {
            flex: 1;
            min-width: 250px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            max-height: 600px;
        }
        
        .tool-section {
            margin-bottom: 20px;
        }
        
        .tool-section h3 {
            margin-bottom: 10px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 5px;
        }
        
        .color-picker {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
            border: 2px solid white;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .brush-size {
            width: 100%;
            margin: 15px 0;
        }
        
        .tool-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .tool-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .canvas-container {
            flex: 3;
            min-width: 300px;
            background: rgba(0, 0, 0, 0.1);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            overflow: auto;
            max-height: 80vh;
        }
        
        #drawing-canvas {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            cursor: crosshair;
        }
        
        .chat-container {
            margin-top: 20px;
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        #chat-messages {
            height: 150px;
            overflow-y: auto;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .message {
            margin-bottom: 8px;
            padding: 5px;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .chat-input {
            display: flex;
            gap: 10px;
        }
        
        #chat-input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }
        
        #chat-input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }
        
        #send-message {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.3);
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        #send-message:hover {
            background: rgba(255, 255, 255, 0.4);
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .tools-panel {
                width: 100%;
            }
            
            #drawing-canvas {
                width: 100% !important;
                height: auto !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Совместное рисование</h1>
            <p class="subtitle">Рисуйте вместе с другими пользователями на одном большом холсте!</p>
            <div class="online-counter">
                Сейчас рисуют: <span id="users-count">1</span>
            </div>
        </header>
        
        <div class="main-content">
            <div class="tools-panel">
                <div class="tool-section">
                    <h3>Цвета</h3>
                    <div class="color-picker">
                        <div class="color-option" style="background-color: #000000;" data-color="#000000"></div>
                        <div class="color-option" style="background-color: #ff0000;" data-color="#ff0000"></div>
                        <div class="color-option" style="background-color: #0000ff;" data-color="#0000ff"></div>
                        <div class="color-option" style="background-color: #00ff00;" data-color="#00ff00"></div>
                        <div class="color-option" style="background-color: #ffff00;" data-color="#ffff00"></div>
                        <div class="color-option" style="background-color: #ff00ff;" data-color="#ff00ff"></div>
                        <div class="color-option" style="background-color: #00ffff;" data-color="#00ffff"></div>
                        <div class="color-option" style="background-color: #ffffff;" data-color="#ffffff"></div>
                    </div>
                    <input type="color" id="custom-color" class="tool-btn" value="#000000">
                </div>
                
                <div class="tool-section">
                    <h3>Размер кисти</h3>
                    <input type="range" id="brush-size" class="brush-size" min="1" max="50" value="5">
                    <span id="brush-size-value">5px</span>
                </div>
                
                <div class="tool-section">
                    <h3>Инструменты</h3>
                    <button class="tool-btn" id="clear-btn">Очистить холст</button>
                    <button class="tool-btn" id="save-btn">Сохранить рисунок</button>
                </div>
                
                <div class="chat-container">
                    <h3>Чат</h3>
                    <div id="chat-messages">
                        <div class="message">Система: Добро пожаловать! Рисуйте вместе с другими!</div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chat-input" placeholder="Ваше сообщение...">
                        <button id="send-message">Отпр.</button>
                    </div>
                </div>
            </div>
            
            <div class="canvas-container">
                <canvas id="drawing-canvas" width="1600" height="1200"></canvas>
            </div>
        </div>
        
        <footer>
            <p>Совместное рисование &copy; 2023. Творите вместе с другими!</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const canvas = document.getElementById('drawing-canvas');
            const ctx = canvas.getContext('2d');
            const colorOptions = document.querySelectorAll('.color-option');
            const customColor = document.getElementById('custom-color');
            const brushSize = document.getElementById('brush-size');
            const brushSizeValue = document.getElementById('brush-size-value');
            const clearBtn = document.getElementById('clear-btn');
            const saveBtn = document.getElementById('save-btn');
            const usersCount = document.getElementById('users-count');
            const chatMessages = document.getElementById('chat-messages');
            const chatInput = document.getElementById('chat-input');
            const sendMessage = document.getElementById('send-message');
            
            let isDrawing = false;
            let lastX = 0;
            let lastY = 0;
            let currentColor = '#000000';
            let currentSize = 5;
            
            // Инициализация холста
            function initCanvas() {
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.lineJoin = 'round';
                ctx.lineCap = 'round';
                setColor(currentColor);
                setSize(currentSize);
                
                // Загрузка изображения из localStorage при запуске
                const savedImage = localStorage.getItem('sharedCanvas');
                if (savedImage) {
                    const img = new Image();
                    img.onload = function() {
                        ctx.drawImage(img, 0, 0);
                    };
                    img.src = savedImage;
                }
            }
            
            // Установка цвета
            function setColor(color) {
                currentColor = color;
                ctx.strokeStyle = currentColor;
                customColor.value = currentColor;
            }
            
            // Установка размера кисти
            function setSize(size) {
                currentSize = size;
                ctx.lineWidth = currentSize;
            }
            
            // Начало рисования
            function startDrawing(e) {
                isDrawing = true;
                [lastX, lastY] = [e.offsetX, e.offsetY];
            }
            
            // Рисование
            function draw(e) {
                if (!isDrawing) return;
                
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(e.offsetX, e.offsetY);
                ctx.stroke();
                [lastX, lastY] = [e.offsetX, e.offsetY];
                
                // Сохраняем изменения в localStorage
                saveCanvasState();
            }
            
            // Остановка рисования
            function stopDrawing() {
                isDrawing = false;
            }
            
            // Очистка холста
            function clearCanvas() {
                if (confirm('Очистить весь холст для всех пользователей?')) {
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    ctx.strokeStyle = currentColor;
                    saveCanvasState();
                    addMessage('Система', 'Холст был очищен!');
                }
            }
            
            // Сохранение рисунка
            function saveDrawing() {
                const link = document.createElement('a');
                link.download = 'совместный-рисунок.png';
                link.href = canvas.toDataURL();
                link.click();
            }
            
            // Сохранение состояния холста
            function saveCanvasState() {
                localStorage.setItem('sharedCanvas', canvas.toDataURL());
            }
            
            // Добавление сообщения в чат
            function addMessage(user, text) {
                const messageElement = document.createElement('div');
                messageElement.classList.add('message');
                messageElement.textContent = `${user}: ${text}`;
                chatMessages.appendChild(messageElement);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Отправка сообщения
            function sendChatMessage() {
                const message = chatInput.value.trim();
                if (message) {
                    addMessage('Вы', message);
                    chatInput.value = '';
                }
            }
            
            // Имитация других пользователей
            function simulateOtherUsers() {
                // Увеличиваем счетчик пользователей
                let count = 5 + Math.floor(Math.random() * 15);
                usersCount.textContent = count;
                
                // Периодически обновляем холст (имитация изменений от других пользователей)
                setInterval(() => {
                    const savedImage = localStorage.getItem('sharedCanvas');
                    if (savedImage) {
                        const img = new Image();
                        img.onload = function() {
                            ctx.drawImage(img, 0, 0);
                        };
                        img.src = savedImage;
                    }
                }, 2000);
                
                // Периодически добавляем сообщения от других пользователей
                const messages = [
                    "Привет! Крутой рисунок!",
                    "Я добавлю немного цвета здесь",
                    "Давайте нарисуем солнце в углу!",
                    "Кто это рисует? Очень красиво!",
                    "Мне нравится этот совместный холст!",
                    "Давайте создадим шедевр вместе!",
                    "Как насчет радуги?",
                    "Это так весело!)",
                    "Я добавлю несколько звезд на небо",
                    "Рисуйте свободно, не бойтесь экспериментировать!"
                ];
                
                const users = ["Анна", "Максим", "София", "Артем", "Виктория", "Дмитрий", "Ольга", "Иван"];
                
                setInterval(() => {
                    if (Math.random() > 0.7) {
                        const user = users[Math.floor(Math.random() * users.length)];
                        const message = messages[Math.floor(Math.random() * messages.length)];
                        addMessage(user, message);
                    }
                }, 10000);
            }
            
            // События мыши
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);
            
            // События касания для мобильных устройств
            canvas.addEventListener('touchstart', e => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const mouseEvent = new MouseEvent('mousedown', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });
            
            canvas.addEventListener('touchmove', e => {
                e.preventDefault();
                const touch = e.touches[0];
                const rect = canvas.getBoundingClientRect();
                const mouseEvent = new MouseEvent('mousemove', {
                    clientX: touch.clientX,
                    clientY: touch.clientY
                });
                canvas.dispatchEvent(mouseEvent);
            });
            
            canvas.addEventListener('touchend', e => {
                e.preventDefault();
                const mouseEvent = new MouseEvent('mouseup', {});
                canvas.dispatchEvent(mouseEvent);
            });
            
            // Обработчики выбора цвета
            colorOptions.forEach(option => {
                option.addEventListener('click', () => {
                    setColor(option.getAttribute('data-color'));
                });
            });
            
            customColor.addEventListener('change', () => {
                setColor(customColor.value);
            });
            
            // Обработчик изменения размера кисти
            brushSize.addEventListener('input', () => {
                setSize(brushSize.value);
                brushSizeValue.textContent = `${brushSize.value}px`;
            });
            
            // Обработчики кнопок
            clearBtn.addEventListener('click', clearCanvas);
            saveBtn.addEventListener('click', saveDrawing);
            
            // Обработчики чата
            sendMessage.addEventListener('click', sendChatMessage);
            chatInput.addEventListener('keypress', e => {
                if (e.key === 'Enter') {
                    sendChatMessage();
                }
            });
            
            // Инициализация
            initCanvas();
            simulateOtherUsers();
        });
    </script>
</body>
</html>
